load("//toolchain/profiles:BUILD.bzl", "cc_toolchain_profile")

## local profile generated by ./configure

## FIXME: cross-compiling.  OC_CFLAGS are platform-dependent, so to cross compile we need the flags for the target, not the build host.
## e.g. linux uses
##  '-fexcess-precision=standard'
##  '-fno-tree-vrp'
## if you try to xcompile on linux targeting macos these throw [-Werror,-Wignored-optimization-argument]

def fix_oc_cflags(x):
    if "-O2" in x:
        x.remove("-O2")
    if "-g" in x:
        x.remove("-g")

    return x

OC_CFLAGS = fix_oc_cflags("@oc_cflags@".split(" "))

#####################
cc_toolchain_profile(
    name     = "local",
    # for testing, some harmless flags
    CFLAGS   = OC_CFLAGS,
    CPPFLAGS = ["-Rmodule-import"],
    LDFLAGS  = ["-Rmodule-build"],
    DEFINES  = ["LOCAL_DEF"]
)
