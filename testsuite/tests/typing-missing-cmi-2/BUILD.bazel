load("@bazel_skylib//rules:diff_test.bzl", "diff_test")

load("//test:rules.bzl",
     "test_module",
     "test_infer_signature",
     "test_signature",
)

test_suite(
    name  = "typing-missing-cmi-2",
    tests = ["Baz_test"]
)

diff_test(
    name = "Baz_test",
    file1 = ":Baz",
    file2 = "test.compilers.reference",
    timeout = "short",
    tags = ["inline_expect", "cmi"]
)

test_infer_signature(
    name   = "Baz",
    struct = "baz.ml",
    sig_deps   = ["Bar_cmi"],
    suppress_cmi = [":Foo_cmi"]
)

test_signature(
    name = "Bar_cmi",
    src  = "bar.mli",
    deps   = [":Foo_cmi"]
)

test_signature(
    name = "Foo_cmi",
    src  = "foo.mli",
)

