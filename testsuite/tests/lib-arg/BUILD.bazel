load("@bazel_skylib//rules:diff_test.bzl", "diff_test")
load("//test:rules.bzl",
     "test_module",
     "batch_test_macro",
     "inline_expect_module",
     # "inline_expect_test",
)

load("//config:WARNINGS.bzl", "w")

test_suite(
    name = "lib-arg",
    tests  = [
        # ":Test_rest_all_test",
        ":Testarg_test",
        ":Testerror_test",
    ],
)

diff_test(
    name = "Test_rest_all_test",
    file1 = "test_rest_all.ml",
    file2 = ":Test_rest_all",
    timeout = "short",
    tags = ["inline_expect"]
)

inline_expect_module(
    name   = "Test_rest_all",
    struct = "test_rest_all.ml",
    stdlib_deps = [
        "//stdlib:Stdlib.Arg",
        "//stdlib:Stdlib",
    ],
    # timeout = "short"
)

batch_test_macro(
    name     = "Testarg_test",
    stdout_actual   = "testarg.stdout",
    stdout_expected = "testarg.reference",
    test_module = ":Testarg",
    timeout  = "short"
)

test_module(
    name   = "Testarg",
    struct = "testarg.ml",
    warnings = [w.MISSING_MLI_70],
    stdlib_deps   = [
        "//stdlib:Stdlib.Arg",
        "//stdlib:Stdlib.Printf"
    ]
)

batch_test_macro(
    name     = "Testerror_test",
    stdout_actual   = "testerror.stdout",
    stdout_expected = "testerror.reference",
    test_module = ":Testerror",
    timeout  = "short"
)

test_module(
    name   = "Testerror",
    struct = "testerror.ml",
    warnings = [w.UNEXPECTED_DOCSTRING_50, w.MISSING_MLI_70],
    stdlib_deps   = [
        "//stdlib:Stdlib.Arg",
        "//stdlib:Stdlib.Array"
    ]
)

