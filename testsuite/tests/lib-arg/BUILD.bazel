load("//bzl:rules.bzl",
     "test_archive",
     "test_executable",
     "test_library",
     "test_module",
     "test_signature",
     "ocaml_test",
     "expect_test",
     "inline_expect_test",
     "lambda_expect_test"
)

MODULE_OPTS = []

test_suite(
    name = "tests",
    tests  = [
        ":Test_rest_all",
        ":testarg_expect_test",
        ":testerror_expect_test",
    ],
)

inline_expect_test(
    name   = "Test_rest_all",
    src = "test_rest_all.ml",
)

expect_test(
    name     = "testarg_expect_test",
    stdout   = "testarg.stdout",
    expected = "testarg.reference",
    main     = ":Testarg",
    timeout  = "short"
)

test_module(
    name   = "Testarg",
    struct = "testarg.ml",
    opts = MODULE_OPTS,
    deps   = [
        "//stdlib:Stdlib.Arg",
        "//stdlib:Stdlib.Printf"
    ]
)

expect_test(
    name     = "testerror_expect_test",
    stdout   = "testerror.stdout",
    expected = "testerror.reference",
    main     = ":Testerror",
    timeout  = "short"
)

test_module(
    name   = "Testerror",
    struct = "testerror.ml",
    opts = MODULE_OPTS,
    deps   = [
        "//stdlib"
    ]
)

