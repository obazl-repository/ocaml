load("//test:rules.bzl",
     "test_module",
     "batch_tests",
     "module_program_tests")

load("//config:WARNINGS.bzl", "w")

test_suite(
    name = "lib-bigarray",
    tests  = [
        ":Bigarrays_tests",
        ":Change_layout_tests",
        ":Fftba_tests",
        ":Pr5115_tests",
        ":Weak_bigarray_tests",
    ],
)

#####################
module_program_tests(
    name              = "Bigarrays_tests",
    structfile        = "bigarrays.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Filename",
        "//stdlib:Stdlib.Gc",
        "//stdlib:Stdlib.Int64",
        "//stdlib:Stdlib.Printf"
    ],
    warnings = {"disable": ["open-shadow-identifier", "unused-var-strict"]},
    stdout_expected   = "bigarrays.reference",
)

#####################
module_program_tests(
    name              = "Change_layout_tests",
    structfile        = "change_layout.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Format",
    ],
    stdout_expected   = "change_layout.reference",
)

#####################
module_program_tests(
    name              = "Fftba_tests",
    structfile        = "fftba.ml",
    stdlib_deps   = ["//stdlib:Stdlib.Bigarray"],
    warnings = {"disable": ["unexpected-docstring", "unused-for-index"]},
    stdout_expected   = "fftba.reference",
)

#####################
module_program_tests(
    name              = "Pr5115_tests",
    structfile        = "pr5115.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Printf"
    ],
    stdout_expected   = "pr5115.reference",
)

#####################
module_program_tests(
    name              = "Weak_bigarray_tests",
    structfile        = "weak_bigarray.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Gc",
        "//stdlib:Stdlib.Weak"
    ],
    stdout_expected   = "weak_bigarray.reference",
)
