load("//test:rules.bzl", "test_module", "batch_test_macro")

test_suite(
    name = "lib-bigarray",
    tests  = [
        ":Bigarrays_test",
        ":Change_layout_test",
        ":Fftba_test",
        ":Pr5115_test",
        ":Weak_bigarray_test",
    ],
)

batch_test_macro(
    name    = "Bigarrays_test",
    stdout_actual   = "Bigarrays.stdout",
    stdout_expected = "bigarrays.reference",
    test_module = ":Bigarrays",
    timeout = "short"
)

test_module(
    name   = "Bigarrays",
    struct = "bigarrays.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Filename",
        "//stdlib:Stdlib.Gc",
        "//stdlib:Stdlib.Int64",
        "//stdlib:Stdlib.Printf"
    ]
)

batch_test_macro(
    name     = "Change_layout_test",
    stdout_actual   = "change_layout.stdout",
    stdout_expected = "change_layout.reference",
    test_module = ":Change_layout",
    timeout  = "short"
)

test_module(
    name   = "Change_layout",
    struct = "change_layout.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Format",
    ]
)

batch_test_macro(
    name     = "Fftba_test",
    stdout_actual   = "fftba.stdout",
    stdout_expected = "fftba.reference",
    test_module = ":Fftba",
    timeout  = "short"
)

test_module(
    name   = "Fftba",
    struct = "fftba.ml",
    stdlib_deps   = ["//stdlib:Stdlib.Bigarray"]
)

batch_test_macro(
    name     = "Pr5115_test",
    stdout_actual   = "pr5115.stdout",
    stdout_expected = "pr5115.reference",
    test_module = ":Pr5115",
    timeout  = "short"
)

test_module(
    name   = "Pr5115",
    struct = "pr5115.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Printf"
    ]
)

batch_test_macro(
    name     = "Weak_bigarray_test",
    stdout_actual   = "weak_bigarray.stdout",
    stdout_expected = "weak_bigarray.reference",
    test_module = ":Weak_bigarray",
    timeout  = "short"
)

test_module(
    name   = "Weak_bigarray",
    struct = "weak_bigarray.ml",
    stdlib_deps   = [
        "//stdlib:Stdlib.Bigarray",
        "//stdlib:Stdlib.Gc",
        "//stdlib:Stdlib.Weak"
    ]
)

