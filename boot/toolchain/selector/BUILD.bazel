load("//toolchain/selector:BUILD.bzl", "toolchain_selector")

package(default_visibility=["//visibility:public"])

exports_files(glob(["*.bazel"]))

# toolchain_selector(  ## ocamlc.byte, ocamlopt.byte from ocamlc.byte
#     name           = "vmvm",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:vmvm",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter",
#     ],
#     target_host_constraints = [
#         "//platform/constraints/ocaml/executor:vm_executor",
#         # "//platform/constraints/ocaml/emitter:vm_emitter",
#     ],
# )

# toolchain_selector(  ## ocamlopt.byte, rom ocamlc.byte
#     name           = "vv_vv",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:vv_vv",
#     build_host_constraints  = [
#         # any cpu/os pair, plus:
#         "//platform/constraints/ocaml/executor:vm_executor",
#     ],
#     target_host_constraints = [
#         # any cpu/os pair, plus:
#         "//platform/constraints/ocaml/executor:vm_executor",
#     ],
# )

# toolchain_selector(  ## ocamlopt.byte, rom ocamlc.byte
#     name           = "vv_vs",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:vv_vs",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor"],
#     target_host_constraints = [
#         "//platform/constraints/ocaml/executor:vm_executor"],
#     target_host_configuration = [
#         "//config/target/emitter:sys?"]
# )

# toolchain_selector(
#     name           = "vs_ss",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:vs_ss",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor"],
#     target_host_constraints = [
#         "//platform/constraints/ocaml/executor:sys_executor"],
#     target_host_configuration = [
#         "//config/target/emitter:sys?"]
# )

toolchain_selector(
    name           = "vs_sv",
    type           = "//toolchain/type:boot",
    adapter        = "//toolchain/adapter:vs_sv",
    build_host_constraints  = [
        "//platform/constraints/ocaml/executor:vm_executor"],
    target_host_constraints = [
        "//platform/constraints/ocaml/executor:sys_executor"],
    target_host_configuration = [
        "//config/target/emitter:vm?"]
)

toolchain_selector(
    name           = "sys_sysvm",
    type           = "//toolchain/type:boot",
    adapter        = "//toolchain/adapter:vm_vmsys",
    build_host_constraints  = [
        "//platform/constraints/ocaml/executor:sys_executor"],
    target_host_constraints = [
        "//platform/constraints/ocaml/executor:sys_executor"],
    target_host_configuration = [
        "//config/target/emitter:vm?"]
)

## vmsys: vmvm to sysvm (ocamlc.opt), syssys (ocamlopt.opt)
toolchain_selector(
    name           = "vmsys",
    type           = "//toolchain/type:boot",
    adapter        = "//toolchain/adapter:vmsys",
    build_host_constraints  = [
        "//platform/constraints/ocaml/executor:vm_executor",
        "//platform/constraints/ocaml/emitter:vm_emitter",
    ],
    target_host_constraints = [
        "//platform/constraints/ocaml/executor:sys_executor",
        # "//platform/constraints/ocaml/emitter:vm_emitter",
    ],
)

###################
toolchain_selector(  ## ocamlc.opt from ocamlopt.byte
    name           = "syssys",
    type           = "//toolchain/type:boot",
    adapter        = "//toolchain/adapter:sys_vm_vm__sys_vm_sys",
    build_host_constraints  = [
        "//platform/constraints/ocaml/executor:vm_executor",
        "//platform/constraints/ocaml/emitter:sys_emitter",
    ],
    target_host_constraints = [
        "//platform/constraints/ocaml/executor:sys_executor",
    #     "//platform/constraints/ocaml/emitter:vm_emitter",
    ],
)

################################################################
# toolchain_selector(
#     name           = "boot",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:boot",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor",

#         # platform: boot_build == sys_vm_vm + build + boot
#         # "//platform/constraints/ocaml/build/executor:vm_executor",
#         # "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         # "//platform/constraints/stage:boot"
#     ],
#     target_host_constraints = [
#         "//platform/constraints/ocaml/executor:vm_executor",

#         # platform: boot_target == sys_vm_vm + target + boot
#         # "//platform/constraints/ocaml/target/executor:vm_executor",
#         # "//platform/constraints/ocaml/target/emitter:vm_emitter",
#         # "//platform/constraints/stage:boot"
#     ],
# )


# toolchain_selector(
#     name           = "baseline",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:baseline",
#     build_host_constraints  = [
#         # platform: boot_build == sys_vm_vm + build + boot
#         "//platform/constraints/ocaml/build/executor:vm_executor",
#         "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         "//platform/constraints/stage:baseline"
#     ],
#     target_host_constraints = [
#         # platform: boot_target == sys_vm_vm + target + boot
#         # "//platform/constraints/ocaml/target/executor:vm_executor",
#         # "//platform/constraints/ocaml/target/emitter:vm_emitter",
#         "//platform/constraints/stage:baseline"
#     ],
# )

# toolchain_selector(
#     name           = "boot_boot",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:boot",
#     build_host_constraints  = [
#         # platform: boot_build == sys_vm_vm + build + boot
#         "//platform/constraints/ocaml/build/executor:vm_executor",
#         "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         "//platform/constraints/stage:boot"
#     ],
#     target_host_constraints = [
#         # platform: boot_target == sys_vm_vm + target + boot
#         "//platform/constraints/ocaml/build/executor:vm_executor",
#         "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         "//platform/constraints/stage:boot"
#     ],
# )

## for toolchain transitions setting target = build
# toolchain_selector(
#     name           = "baseline_involute",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:boot",
#     build_host_constraints  = [
#         # platform: boot_build == sys_vm_vm + build + boot
#         "//platform/constraints/ocaml/build/executor:vm_executor",
#         "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         "//platform/constraints/stage:baseline"
#     ],
#     target_host_constraints  = [
#         # platform: boot_build == sys_vm_vm + build + boot
#         "//platform/constraints/ocaml/build/executor:vm_executor",
#         "//platform/constraints/ocaml/build/emitter:vm_emitter",
#         "//platform/constraints/stage:baseline"
#     ],
# )

# toolchain_selector(
#     name           = "vmvm",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:boot",
#     build_host_constraints  = [
#         # platform: sys_vm_vm
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
#     target_host_constraints  = [
#         # platform: sys_vm_vm
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
# )

# toolchain_selector(
#     name           = "vmsys",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:baseline",
#     build_host_constraints  = [
#         # platform: sys_vm_vm
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
#     target_host_constraints  = [
#         # platform: sys_vm_sys
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:sys_emitter"
#     ],
# )

# toolchain_selector(
#     name           = "xvmsys",
#     type           = "//toolchain/type:boot",
#     adapter        = "//toolchain/adapter:baseline",
#     build_host_constraints  = [
#         # platform: sys_vm_vm
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
#     target_host_constraints  = [
#         # platform: sys_vm_sys
#         "//platform/constraints/ocaml/target/executor:vm_executor",
#         "//platform/constraints/ocaml/target/emitter:sys_emitter"
#     ],
# )

# toolchain_selector(
#     name           = "baseline",
#     type           = "//toolchain/type:baseline",
#     adapter        = "//toolchain/adapter:baseline",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter",
#         # make this unselectable:
#         # "//platform/constraints/stage:prod",
#     ],
#     # target_host_constraints  = [
#     #     "//platform/constraints/ocaml/executor:vm_executor",
#     #     "//platform/constraints/ocaml/emitter:vm_emitter"
#     # ],
# )

# toolchain_selector(
#     name           = "stdlib",
#     type           = "//toolchain/type:stdlib",
#     adapter        = "//toolchain/adapter:stdlib",
#     build_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
#     target_host_constraints  = [
#         "//platform/constraints/ocaml/executor:vm_executor",
#         "//platform/constraints/ocaml/emitter:vm_emitter"
#     ],
# )

